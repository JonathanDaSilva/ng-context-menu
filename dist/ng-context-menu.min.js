angular.module("ng-context-menu",[]).factory("ContextMenuService",function(){return{element:null,menuElement:null}}).directive("contextMenu",["$document","ContextMenuService",function(e,n){return{restrict:"A",scope:{callback:"&contextMenu",disabled:"&contextMenuDisabled"},link:function(t,i,l){function o(e,n){n.addClass("open"),n=n[0];var t=window,i=t.document.documentElement,l=t.document.getElementsByTagName("body")[0],o=t.innerWidth||i.clientWidth||l.clientWidth,u=t.innerHeight||i.clientHeight||l.clientHeight,c=n.getBoundingClientRect();c.height||(c.height=c.bottom-c.top),c.width||(c.width=c.right-c.left);var d={left:e.pageX+c.width+20,top:e.pageY+c.height+20};n.style.top=d.top>u?e.pageY-c.height+"px":e.pageY+"px",n.style.left=d.left>o?e.pageX-c.width+"px":e.pageX+"px",a=!0}function u(e){e.removeClass("open"),a=!1}function c(e){!t.disabled()&&a&&27===e.keyCode&&t.$apply(function(){u(n.menuElement)})}function d(e){t.disabled()||!a||2===e.button&&e.target===n.element||t.$apply(function(){u(n.menuElement)})}var a=!1;i.bind("contextmenu",function(e){t.disabled()||(null!==n.menuElement&&u(n.menuElement),n.menuElement=angular.element(document.getElementById(l.target)),n.element=e.target,console.log("set",n.element),e.preventDefault(),e.stopPropagation(),t.$apply(function(){t.callback({$event:e}),o(e,n.menuElement)}))}),e.bind("keyup",c),e.bind("click",d),e.bind("contextmenu",d),t.$on("$destroy",function(){e.unbind("keyup",c),e.unbind("click",d),e.unbind("contextmenu",d)})}}}]);